{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}/Users/leticiajuarez/Desktop/621 - Field Class Labor/Homeworks/HW3/HW3.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res} 2 Oct 2018, 19:09:11
{txt}
{com}. 
. 
. *Get Data
. use MROZ.dta
{txt}
{com}. 
. label variable kidslt6 "number kids < 6 years"
{txt}
{com}. label variable kidsge6 "number kids 6-18"
{txt}
{com}. g all=1 
{txt}
{com}. g nl= (faminc - wage*hours - huswage*hushrs)/1000
{txt}
{com}. g age2=age^2
{txt}
{com}. g age3=age^3
{txt}
{com}. g ed2=edu^2
{txt}
{com}. g ed3=educ^3
{txt}
{com}. g inter1=age*educ
{txt}
{com}. g inter2=age2*educ
{txt}
{com}. g inter3=age*ed2
{txt}
{com}. 
. 
. global horder age2 age3 ed2 ed3 inter1 inter2 inter3 unem city motheduc fatheduc
{txt}
{com}. global back nwifeinc kidslt6 kidsge6 age educ
{txt}
{com}. 
. 
. ****************
. *   Question 1 *
. ****************
. 
. 
. *--------
. *   A   *
. *--------
. g w = (hours > 0)
{txt}
{com}. probit w $back $horder

{res}{txt}Iteration 0:{space 3}log likelihood = {res: -514.8732}  
Iteration 1:{space 3}log likelihood = {res: -450.8853}  
Iteration 2:{space 3}log likelihood = {res: -450.4777}  
Iteration 3:{space 3}log likelihood = {res:-450.47746}  
Iteration 4:{space 3}log likelihood = {res:-450.47746}  
{res}
{txt}Probit regression{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}LR chi2({res}16{txt}){col 67}= {res}    128.79
{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000
{txt}Log likelihood = {res}-450.47746{txt}{col 49}Pseudo R2{col 67}= {res}    0.1251

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}           w{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 4}nwifeinc {c |}{col 14}{res}{space 2} -.022003{col 26}{space 2} .0047666{col 37}{space 1}   -4.62{col 46}{space 3}0.000{col 54}{space 4}-.0313454{col 67}{space 3}-.0126606
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-.8579509{col 26}{space 2} .1188431{col 37}{space 1}   -7.22{col 46}{space 3}0.000{col 54}{space 4}-1.090879{col 67}{space 3}-.6250226
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-.0603097{col 26}{space 2} .0439087{col 37}{space 1}   -1.37{col 46}{space 3}0.170{col 54}{space 4}-.1463692{col 67}{space 3} .0257497
{txt}{space 9}age {c |}{col 14}{res}{space 2} .7521026{col 26}{space 2}   .76984{col 37}{space 1}    0.98{col 46}{space 3}0.329{col 54}{space 4}-.7567562{col 67}{space 3} 2.260961
{txt}{space 8}educ {c |}{col 14}{res}{space 2}  1.09907{col 26}{space 2} 1.922726{col 37}{space 1}    0.57{col 46}{space 3}0.568{col 54}{space 4}-2.669404{col 67}{space 3} 4.867544
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-.0151855{col 26}{space 2} .0145537{col 37}{space 1}   -1.04{col 46}{space 3}0.297{col 54}{space 4}-.0437101{col 67}{space 3} .0133392
{txt}{space 8}age3 {c |}{col 14}{res}{space 2}  .000107{col 26}{space 2} .0001011{col 37}{space 1}    1.06{col 46}{space 3}0.290{col 54}{space 4}-.0000911{col 67}{space 3} .0003051
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2}-.0636591{col 26}{space 2} .1056755{col 37}{space 1}   -0.60{col 46}{space 3}0.547{col 54}{space 4}-.2707794{col 67}{space 3} .1434611
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2} .0012697{col 26}{space 2} .0023487{col 37}{space 1}    0.54{col 46}{space 3}0.589{col 54}{space 4}-.0033336{col 67}{space 3}  .005873
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2}-.0154558{col 26}{space 2} .0446633{col 37}{space 1}   -0.35{col 46}{space 3}0.729{col 54}{space 4}-.1029943{col 67}{space 3} .0720827
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-2.10e-06{col 26}{space 2} .0003764{col 37}{space 1}   -0.01{col 46}{space 3}0.996{col 54}{space 4}-.0007399{col 67}{space 3} .0007357
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} .0006687{col 26}{space 2} .0008759{col 37}{space 1}    0.76{col 46}{space 3}0.445{col 54}{space 4}-.0010481{col 67}{space 3} .0023855
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-.0102966{col 26}{space 2} .0161046{col 37}{space 1}   -0.64{col 46}{space 3}0.523{col 54}{space 4} -.041861{col 67}{space 3} .0212678
{txt}{space 8}city {c |}{col 14}{res}{space 2} .0414417{col 26}{space 2}   .10854{col 37}{space 1}    0.38{col 46}{space 3}0.703{col 54}{space 4}-.1712928{col 67}{space 3} .2541763
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} .0026455{col 26}{space 2}  .018479{col 37}{space 1}    0.14{col 46}{space 3}0.886{col 54}{space 4}-.0335726{col 67}{space 3} .0388636
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-.0125127{col 26}{space 2}  .017534{col 37}{space 1}   -0.71{col 46}{space 3}0.475{col 54}{space 4}-.0468787{col 67}{space 3} .0218532
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-14.06639{col 26}{space 2} 15.98708{col 37}{space 1}   -0.88{col 46}{space 3}0.379{col 54}{space 4} -45.4005{col 67}{space 3} 17.26772
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. *--------
. *   B   *
. *--------
. 
. program myolsnorm
{txt}  1{com}. version 14
{txt}  2{com}. args lnf theta1 lnsigma
{txt}  3{com}. tempvar sigma
{txt}  4{com}. gen double `sigma' = exp(`lnsigma')
{txt}  5{com}. quietly replace `lnf' = ln(normalden($ML_y1, `theta1', `sigma'))
{txt}  6{com}. end
{txt}
{com}. 
. *OLS
. ml model lf myolsnorm (beta: hours = $back $horder)(lnsigma:)
{res}{txt}
{com}. ml search
{res}{txt}initial:{col 16}log likelihood = {res:    -<inf>}  (could not be evaluated)
feasible:{col 16}log likelihood = {res:-8222.9633}
rescale:{col 16}log likelihood = {res:-8222.9633}
rescale eq:{col 16}log likelihood = {res:-8222.5569}

{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-8222.5569}
rescale:{col 16}log likelihood = {res:-8222.5569}
rescale eq:{col 16}log likelihood = {res:-8222.5569}
{res}{txt}Iteration 0:{space 3}log likelihood = {res:-8222.5569}  
Iteration 1:{space 3}log likelihood = {res:-7597.5351}  (not concave)
Iteration 2:{space 3}log likelihood = {res:-6562.9214}  (not concave)
Iteration 3:{space 3}log likelihood = {res:-6426.4361}  (not concave)
Iteration 4:{space 3}log likelihood = {res:-6363.7583}  
Iteration 5:{space 3}log likelihood = {res:-6194.7653}  
Iteration 6:{space 3}log likelihood = {res:-6112.6136}  
Iteration 7:{space 3}log likelihood = {res:-6112.3797}  
Iteration 8:{space 3}log likelihood = {res:-6112.3797}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}Wald chi2({res}16{txt}){col 67}= {res}    114.73
{txt}Log likelihood = {res}-6112.3797{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}beta         {txt}{c |}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}  -10.486{col 26}{space 2} 2.748094{col 37}{space 1}   -3.82{col 46}{space 3}0.000{col 54}{space 4}-15.87217{col 67}{space 3}-5.099837
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-461.6535{col 26}{space 2} 65.20471{col 37}{space 1}   -7.08{col 46}{space 3}0.000{col 54}{space 4}-589.4523{col 67}{space 3}-333.8546
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-109.3732{col 26}{space 2} 26.84299{col 37}{space 1}   -4.07{col 46}{space 3}0.000{col 54}{space 4}-161.9845{col 67}{space 3}-56.76194
{txt}{space 9}age {c |}{col 14}{res}{space 2} 364.3008{col 26}{space 2} 453.5585{col 37}{space 1}    0.80{col 46}{space 3}0.422{col 54}{space 4}-524.6574{col 67}{space 3} 1253.259
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-680.5892{col 26}{space 2} 1095.998{col 37}{space 1}   -0.62{col 46}{space 3}0.535{col 54}{space 4}-2828.705{col 67}{space 3} 1467.527
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-9.478057{col 26}{space 2} 8.731676{col 37}{space 1}   -1.09{col 46}{space 3}0.278{col 54}{space 4}-26.59183{col 67}{space 3} 7.635714
{txt}{space 8}age3 {c |}{col 14}{res}{space 2}  .069975{col 26}{space 2}  .061143{col 37}{space 1}    1.14{col 46}{space 3}0.252{col 54}{space 4} -.049863{col 67}{space 3}  .189813
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 42.77333{col 26}{space 2} 61.61349{col 37}{space 1}    0.69{col 46}{space 3}0.488{col 54}{space 4} -77.9869{col 67}{space 3} 163.5336
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-1.181588{col 26}{space 2} 1.390369{col 37}{space 1}   -0.85{col 46}{space 3}0.395{col 54}{space 4}-3.906661{col 67}{space 3} 1.543484
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} 7.079507{col 26}{space 2} 25.19365{col 37}{space 1}    0.28{col 46}{space 3}0.779{col 54}{space 4}-42.29914{col 67}{space 3} 56.45815
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0583527{col 26}{space 2} .2149201{col 37}{space 1}   -0.27{col 46}{space 3}0.786{col 54}{space 4}-.4795884{col 67}{space 3}  .362883
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} .0496601{col 26}{space 2} .4957944{col 37}{space 1}    0.10{col 46}{space 3}0.920{col 54}{space 4}-.9220791{col 67}{space 3} 1.021399
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-14.90946{col 26}{space 2} 9.804133{col 37}{space 1}   -1.52{col 46}{space 3}0.128{col 54}{space 4} -34.1252{col 67}{space 3} 4.306289
{txt}{space 8}city {c |}{col 14}{res}{space 2} 14.51544{col 26}{space 2} 65.67279{col 37}{space 1}    0.22{col 46}{space 3}0.825{col 54}{space 4}-114.2009{col 67}{space 3} 143.2317
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} 6.862262{col 26}{space 2}  11.2654{col 37}{space 1}    0.61{col 46}{space 3}0.542{col 54}{space 4}-15.21751{col 67}{space 3} 28.94204
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2} -11.2515{col 26}{space 2} 10.64474{col 37}{space 1}   -1.06{col 46}{space 3}0.291{col 54}{space 4} -32.1148{col 67}{space 3} 9.611797
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-915.9593{col 26}{space 2} 9208.462{col 37}{space 1}   -0.10{col 46}{space 3}0.921{col 54}{space 4}-18964.21{col 67}{space 3} 17132.29
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 6.698431{col 26}{space 2} .0257684{col 37}{space 1}  259.95{col 46}{space 3}0.000{col 54}{space 4} 6.647926{col 67}{space 3} 6.748937
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. *Check if it matches OLS REG
. reg hours $back $horder

{txt}      Source {c |}       SS           df       MS      Number of obs   ={res}       753
{txt}{hline 13}{c +}{hline 34}   F(16, 736)      = {res}     7.01
{txt}       Model {c |} {res} 75483860.5        16  4717741.28   {txt}Prob > F        ={res}    0.0000
{txt}    Residual {c |} {res}  495425863       736  673132.966   {txt}R-squared       ={res}    0.1322
{txt}{hline 13}{c +}{hline 34}   Adj R-squared   ={res}    0.1134
{txt}       Total {c |} {res}  570909724       752  759188.463   {txt}Root MSE        =   {res} 820.45

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}  -10.486{col 26}{space 2} 2.779651{col 37}{space 1}   -3.77{col 46}{space 3}0.000{col 54}{space 4}-15.94299{col 67}{space 3}-5.029013
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-461.6535{col 26}{space 2} 65.95346{col 37}{space 1}   -7.00{col 46}{space 3}0.000{col 54}{space 4}-591.1328{col 67}{space 3}-332.1741
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-109.3732{col 26}{space 2} 27.15123{col 37}{space 1}   -4.03{col 46}{space 3}0.000{col 54}{space 4}-162.6763{col 67}{space 3}-56.07014
{txt}{space 9}age {c |}{col 14}{res}{space 2} 364.3008{col 26}{space 2} 458.7667{col 37}{space 1}    0.79{col 46}{space 3}0.427{col 54}{space 4}-536.3465{col 67}{space 3} 1264.948
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-680.5891{col 26}{space 2} 1108.583{col 37}{space 1}   -0.61{col 46}{space 3}0.539{col 54}{space 4}-2856.951{col 67}{space 3} 1495.773
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-9.478056{col 26}{space 2} 8.831942{col 37}{space 1}   -1.07{col 46}{space 3}0.284{col 54}{space 4}-26.81686{col 67}{space 3} 7.860746
{txt}{space 8}age3 {c |}{col 14}{res}{space 2}  .069975{col 26}{space 2} .0618451{col 37}{space 1}    1.13{col 46}{space 3}0.258{col 54}{space 4}-.0514388{col 67}{space 3} .1913887
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 42.77332{col 26}{space 2} 62.32101{col 37}{space 1}    0.69{col 46}{space 3}0.493{col 54}{space 4} -79.5748{col 67}{space 3} 165.1214
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-1.181588{col 26}{space 2} 1.406334{col 37}{space 1}   -0.84{col 46}{space 3}0.401{col 54}{space 4}-3.942493{col 67}{space 3} 1.579316
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} 7.079506{col 26}{space 2} 25.48295{col 37}{space 1}    0.28{col 46}{space 3}0.781{col 54}{space 4}-42.94843{col 67}{space 3} 57.10744
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0583527{col 26}{space 2}  .217388{col 37}{space 1}   -0.27{col 46}{space 3}0.788{col 54}{space 4}-.4851272{col 67}{space 3} .3684219
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} .0496601{col 26}{space 2} .5014877{col 37}{space 1}    0.10{col 46}{space 3}0.921{col 54}{space 4}-.9348567{col 67}{space 3} 1.034177
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-14.90946{col 26}{space 2} 9.916714{col 37}{space 1}   -1.50{col 46}{space 3}0.133{col 54}{space 4}-34.37787{col 67}{space 3} 4.558961
{txt}{space 8}city {c |}{col 14}{res}{space 2} 14.51543{col 26}{space 2} 66.42691{col 37}{space 1}    0.22{col 46}{space 3}0.827{col 54}{space 4}-115.8934{col 67}{space 3} 144.9242
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} 6.862262{col 26}{space 2} 11.39476{col 37}{space 1}    0.60{col 46}{space 3}0.547{col 54}{space 4}-15.50784{col 67}{space 3} 29.23237
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2} -11.2515{col 26}{space 2} 10.76697{col 37}{space 1}   -1.05{col 46}{space 3}0.296{col 54}{space 4}-32.38914{col 67}{space 3} 9.886133
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-915.9591{col 26}{space 2} 9314.203{col 37}{space 1}   -0.10{col 46}{space 3}0.922{col 54}{space 4}-19201.53{col 67}{space 3} 17369.61
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}{txt}
{com}. 
. 
. *--------
. *   C   *
. *--------
. 
. program drop _all
{txt}
{com}. capture program drop mytruncated
{txt}
{com}. 
. program mytruncated
{txt}  1{com}. version 14
{txt}  2{com}. args lnf theta1 lnsigma
{txt}  3{com}. tempvar sigma
{txt}  4{com}. g double `sigma' = exp(`lnsigma') 
{txt}  5{com}. qui replace `lnf' = ln((1/`sigma')*normalden(($ML_y1-`theta1')/`sigma'))-ln(normal(`theta1'/`sigma'))
{txt}  6{com}. qui replace $ML_samp=0 if $ML_y1==0
{txt}  7{com}. end
{txt}
{com}. 
. *multiply by 1/sigma because its not normal (0,1)
. 
. *Truncated Version
. ml model lf mytruncated (beta: hours = $back $horder)(lnsigma:)
{res}{txt}
{com}. ml search
{res}{txt}initial:{col 16}log likelihood = {res:    -<inf>}  (could not be evaluated)
feasible:{col 16}log likelihood = {res:-4377.7962}
rescale:{col 16}log likelihood = {res:-4377.7962}
rescale eq:{col 16}log likelihood = {res:-4377.6527}

{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-4377.6527}
rescale:{col 16}log likelihood = {res:-4377.6527}
rescale eq:{col 16}log likelihood = {res:-4377.6527}
{res}{txt}(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 0:{space 3}log likelihood = {res:-4377.6527}  (not concave)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 1:{space 3}log likelihood = {res:-3578.3002}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 2:{space 3}log likelihood = {res:-3476.3043}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 3:{space 3}log likelihood = {res:-3471.9482}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 4:{space 3}log likelihood = {res:-3466.6233}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 5:{space 3}log likelihood = {res: -3419.108}  (not concave)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 6:{space 3}log likelihood = {res:-3406.9867}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 7:{space 3}log likelihood = {res:-3403.9945}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 8:{space 3}log likelihood = {res:-3401.3449}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 9:{space 3}log likelihood = {res:-3401.3126}  
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
(325 missing values generated)
Iteration 10:{space 2}log likelihood = {res:-3401.3126}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}Wald chi2({res}16{txt}){col 67}= {res}     39.58
{txt}Log likelihood = {res}-3401.3126{txt}{col 49}Prob > chi2{col 67}= {res}    0.0009

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}beta         {txt}{c |}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-7.071286{col 26}{space 2} 5.538967{col 37}{space 1}   -1.28{col 46}{space 3}0.202{col 54}{space 4}-17.92746{col 67}{space 3}  3.78489
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-484.0469{col 26}{space 2} 167.8134{col 37}{space 1}   -2.88{col 46}{space 3}0.004{col 54}{space 4}-812.9552{col 67}{space 3}-155.1386
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-215.9444{col 26}{space 2} 50.25696{col 37}{space 1}   -4.30{col 46}{space 3}0.000{col 54}{space 4}-314.4463{col 67}{space 3}-117.4426
{txt}{space 9}age {c |}{col 14}{res}{space 2} -277.147{col 26}{space 2} 776.2083{col 37}{space 1}   -0.36{col 46}{space 3}0.721{col 54}{space 4}-1798.487{col 67}{space 3} 1244.193
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-4689.516{col 26}{space 2} 2102.495{col 37}{space 1}   -2.23{col 46}{space 3}0.026{col 54}{space 4} -8810.33{col 67}{space 3}-568.7021
{txt}{space 8}age2 {c |}{col 14}{res}{space 2} -4.96709{col 26}{space 2} 15.27853{col 37}{space 1}   -0.33{col 46}{space 3}0.745{col 54}{space 4}-34.91246{col 67}{space 3} 24.97828
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .0523208{col 26}{space 2} .1120591{col 37}{space 1}    0.47{col 46}{space 3}0.641{col 54}{space 4}-.1673111{col 67}{space 3} .2719526
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 237.1019{col 26}{space 2} 116.4408{col 37}{space 1}    2.04{col 46}{space 3}0.042{col 54}{space 4} 8.882037{col 67}{space 3} 465.3217
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-4.252427{col 26}{space 2} 2.587378{col 37}{space 1}   -1.64{col 46}{space 3}0.100{col 54}{space 4}-9.323595{col 67}{space 3} .8187417
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} 76.43944{col 26}{space 2} 46.31838{col 37}{space 1}    1.65{col 46}{space 3}0.099{col 54}{space 4}-14.34291{col 67}{space 3} 167.2218
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2} -.240037{col 26}{space 2} .3954647{col 37}{space 1}   -0.61{col 46}{space 3}0.544{col 54}{space 4}-1.015133{col 67}{space 3} .5350596
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} -1.88593{col 26}{space 2} .9879311{col 37}{space 1}   -1.91{col 46}{space 3}0.056{col 54}{space 4} -3.82224{col 67}{space 3} .0503791
{txt}{space 8}unem {c |}{col 14}{res}{space 2} -28.6413{col 26}{space 2} 17.75382{col 37}{space 1}   -1.61{col 46}{space 3}0.107{col 54}{space 4}-63.43814{col 67}{space 3} 6.155544
{txt}{space 8}city {c |}{col 14}{res}{space 2} 10.40968{col 26}{space 2} 113.9239{col 37}{space 1}    0.09{col 46}{space 3}0.927{col 54}{space 4}-212.8771{col 67}{space 3} 233.6964
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} 12.73594{col 26}{space 2} 19.43082{col 37}{space 1}    0.66{col 46}{space 3}0.512{col 54}{space 4}-25.34776{col 67}{space 3} 50.81964
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-13.51098{col 26}{space 2} 18.72211{col 37}{space 1}   -0.72{col 46}{space 3}0.471{col 54}{space 4}-50.20564{col 67}{space 3} 23.18368
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 25890.28{col 26}{space 2} 16516.59{col 37}{space 1}    1.57{col 46}{space 3}0.117{col 54}{space 4}-6481.634{col 67}{space 3}  58262.2
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 6.780857{col 26}{space 2} .0528774{col 37}{space 1}  128.24{col 46}{space 3}0.000{col 54}{space 4}  6.67722{col 67}{space 3} 6.884495
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. *Check if it matches OLS REG
. truncreg hours $back $horder, ll(0)
{txt}(note: 325 obs. truncated)

Fitting full model:
{res}
{txt}Iteration 0:{space 3}log likelihood = {res:-3411.3446}  
Iteration 1:{space 3}log likelihood = {res:-3401.4854}  
Iteration 2:{space 3}log likelihood = {res:-3401.3129}  
Iteration 3:{space 3}log likelihood = {res:-3401.3126}  
{res}
{txt}Truncated regression
Limit:   lower = {res}         0{txt}{col 49}Number of obs{col 67}= {res}       428
         {txt}upper = {res}      +inf{col 49}{txt}Wald chi2({res}16{txt}){col 67}= {res}     39.58
{txt}Log likelihood = {res}-3401.3126{col 49}{txt}Prob > chi2{col 67}= {res}    0.0009

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-7.071263{col 26}{space 2} 5.538932{col 37}{space 1}   -1.28{col 46}{space 3}0.202{col 54}{space 4}-17.92737{col 67}{space 3} 3.784844
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-484.0447{col 26}{space 2} 167.8123{col 37}{space 1}   -2.88{col 46}{space 3}0.004{col 54}{space 4}-812.9507{col 67}{space 3}-155.1387
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-215.9438{col 26}{space 2} 50.25663{col 37}{space 1}   -4.30{col 46}{space 3}0.000{col 54}{space 4} -314.445{col 67}{space 3}-117.4426
{txt}{space 9}age {c |}{col 14}{res}{space 2} -277.146{col 26}{space 2} 776.2035{col 37}{space 1}   -0.36{col 46}{space 3}0.721{col 54}{space 4}-1798.477{col 67}{space 3} 1244.185
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-4689.505{col 26}{space 2} 2102.482{col 37}{space 1}   -2.23{col 46}{space 3}0.026{col 54}{space 4}-8810.294{col 67}{space 3}-568.7169
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-4.967086{col 26}{space 2} 15.27844{col 37}{space 1}   -0.33{col 46}{space 3}0.745{col 54}{space 4}-34.91228{col 67}{space 3}  24.9781
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .0523207{col 26}{space 2} .1120584{col 37}{space 1}    0.47{col 46}{space 3}0.641{col 54}{space 4}-.1673098{col 67}{space 3} .2719512
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 237.1013{col 26}{space 2} 116.4401{col 37}{space 1}    2.04{col 46}{space 3}0.042{col 54}{space 4} 8.882913{col 67}{space 3} 465.3198
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-4.252417{col 26}{space 2} 2.587363{col 37}{space 1}   -1.64{col 46}{space 3}0.100{col 54}{space 4}-9.323554{col 67}{space 3} .8187203
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} 76.43926{col 26}{space 2} 46.31809{col 37}{space 1}    1.65{col 46}{space 3}0.099{col 54}{space 4}-14.34253{col 67}{space 3}  167.221
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.2400363{col 26}{space 2} .3954622{col 37}{space 1}   -0.61{col 46}{space 3}0.544{col 54}{space 4}-1.015128{col 67}{space 3} .5350553
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2}-1.885926{col 26}{space 2}  .987925{col 37}{space 1}   -1.91{col 46}{space 3}0.056{col 54}{space 4}-3.822224{col 67}{space 3}  .050371
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-28.64122{col 26}{space 2} 17.75371{col 37}{space 1}   -1.61{col 46}{space 3}0.107{col 54}{space 4}-63.43784{col 67}{space 3} 6.155404
{txt}{space 8}city {c |}{col 14}{res}{space 2} 10.40963{col 26}{space 2} 113.9232{col 37}{space 1}    0.09{col 46}{space 3}0.927{col 54}{space 4}-212.8757{col 67}{space 3}  233.695
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2}  12.7359{col 26}{space 2}  19.4307{col 37}{space 1}    0.66{col 46}{space 3}0.512{col 54}{space 4}-25.34757{col 67}{space 3} 50.81937
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-13.51094{col 26}{space 2} 18.72199{col 37}{space 1}   -0.72{col 46}{space 3}0.471{col 54}{space 4}-50.20537{col 67}{space 3}  23.1835
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 25890.22{col 26}{space 2} 16516.48{col 37}{space 1}    1.57{col 46}{space 3}0.117{col 54}{space 4}-6481.492{col 67}{space 3} 58261.94
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 6}/sigma {c |}{col 14}{res}{space 2} 880.8197{col 26}{space 2} 46.57499{col 37}{space 1}   18.91{col 46}{space 3}0.000{col 54}{space 4} 789.5344{col 67}{space 3}  972.105
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. 
. *--------
. *   D   *
. *--------
. program drop _all
{txt}
{com}. capture program drop mytobit
{txt}
{com}. 
. program mytobit
{txt}  1{com}. version 14
{txt}  2{com}. args lnf beta sigma
{txt}  3{com}.     tempvar lnlj
{txt}  4{com}.     quietly {c -(}
{txt}  5{com}.         gen double `lnlj' = log(1-normal(`beta'/`sigma')) if $ML_y1==0 
{txt}  6{com}.         replace `lnlj' = log((1/`sigma')*normalden(($ML_y1-`beta')/`sigma')) if $ML_y1>0 
{txt}  7{com}.         replace `lnf' = `lnlj' 
{txt}  8{com}.     {c )-}
{txt}  9{com}. end
{txt}
{com}. 
. 
. *Tobit
. ml model lf mytobit (beta: hours = $back $horder)(lnsigma:)
{res}{txt}
{com}. ml search
{res}{txt}initial:{col 16}log likelihood = {res:    -<inf>}  (could not be evaluated)
feasible:{col 16}log likelihood = {res: -16565.62}
rescale:{col 16}log likelihood = {res: -4064.218}
rescale eq:{col 16}log likelihood = {res:-3955.1906}

{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-3955.1906}
rescale:{col 16}log likelihood = {res:-3955.1906}
rescale eq:{col 16}log likelihood = {res:-3955.1906}
{res}{txt}Iteration 0:{space 3}log likelihood = {res:-3955.1906}  
Iteration 1:{space 3}log likelihood = {res: -3901.751}  
Iteration 2:{space 3}log likelihood = {res:-3888.6751}  
Iteration 3:{space 3}log likelihood = {res:-3888.6178}  
Iteration 4:{space 3}log likelihood = {res:-3888.6178}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}Wald chi2({res}16{txt}){col 67}= {res}    122.59
{txt}Log likelihood = {res}-3888.6178{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}beta         {txt}{c |}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-22.73918{col 26}{space 2} 5.029718{col 37}{space 1}   -4.52{col 46}{space 3}0.000{col 54}{space 4}-32.59725{col 67}{space 3}-12.88111
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-979.9991{col 26}{space 2} 126.7792{col 37}{space 1}   -7.73{col 46}{space 3}0.000{col 54}{space 4}-1228.482{col 67}{space 3}-731.5165
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-147.4886{col 26}{space 2} 45.51552{col 37}{space 1}   -3.24{col 46}{space 3}0.001{col 54}{space 4}-236.6974{col 67}{space 3}-58.27984
{txt}{space 9}age {c |}{col 14}{res}{space 2} 650.9177{col 26}{space 2}  772.176{col 37}{space 1}    0.84{col 46}{space 3}0.399{col 54}{space 4}-862.5195{col 67}{space 3} 2164.355
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-881.6668{col 26}{space 2} 1917.468{col 37}{space 1}   -0.46{col 46}{space 3}0.646{col 54}{space 4}-4639.835{col 67}{space 3} 2876.501
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-16.15003{col 26}{space 2}  14.8797{col 37}{space 1}   -1.09{col 46}{space 3}0.278{col 54}{space 4} -45.3137{col 67}{space 3} 13.01364
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .1126287{col 26}{space 2} .1052144{col 37}{space 1}    1.07{col 46}{space 3}0.284{col 54}{space 4}-.0935877{col 67}{space 3} .3188452
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 59.21529{col 26}{space 2} 106.9091{col 37}{space 1}    0.55{col 46}{space 3}0.580{col 54}{space 4}-150.3227{col 67}{space 3} 268.7533
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-1.468839{col 26}{space 2} 2.403254{col 37}{space 1}   -0.61{col 46}{space 3}0.541{col 54}{space 4}-6.179131{col 67}{space 3} 3.241453
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} 7.605495{col 26}{space 2} 43.68493{col 37}{space 1}    0.17{col 46}{space 3}0.862{col 54}{space 4}-78.01539{col 67}{space 3} 93.22638
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0265268{col 26}{space 2} .3707276{col 37}{space 1}   -0.07{col 46}{space 3}0.943{col 54}{space 4}-.7531396{col 67}{space 3} .7000859
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2}-.0261476{col 26}{space 2}  .868939{col 37}{space 1}   -0.03{col 46}{space 3}0.976{col 54}{space 4}-1.729237{col 67}{space 3} 1.676942
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-23.34519{col 26}{space 2} 16.64975{col 37}{space 1}   -1.40{col 46}{space 3}0.161{col 54}{space 4} -55.9781{col 67}{space 3} 9.287723
{txt}{space 8}city {c |}{col 14}{res}{space 2} 51.64076{col 26}{space 2}  111.083{col 37}{space 1}    0.46{col 46}{space 3}0.642{col 54}{space 4} -166.078{col 67}{space 3} 269.3595
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} 8.397817{col 26}{space 2} 18.93005{col 37}{space 1}    0.44{col 46}{space 3}0.657{col 54}{space 4} -28.7044{col 67}{space 3} 45.50003
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-17.30998{col 26}{space 2} 18.01224{col 37}{space 1}   -0.96{col 46}{space 3}0.337{col 54}{space 4}-52.61332{col 67}{space 3} 17.99335
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-4185.313{col 26}{space 2} 15920.84{col 37}{space 1}   -0.26{col 46}{space 3}0.793{col 54}{space 4}-35389.59{col 67}{space 3} 27018.96
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 1250.812{col 26}{space 2} 46.93214{col 37}{space 1}   26.65{col 46}{space 3}0.000{col 54}{space 4} 1158.827{col 67}{space 3} 1342.797
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. *Check if it matches OLS REG
. tobit hours $back $horder, ll(0)
{res}{txt}
Refining starting values:

Grid node 0:{space 3}log likelihood = {res:-4021.3737}

Fitting full model:
{res}
{txt}Iteration 0:{space 3}log likelihood = {res:-4021.3737}  
Iteration 1:{space 3}log likelihood = {res:-3905.9974}  
Iteration 2:{space 3}log likelihood = {res:-3888.7212}  
Iteration 3:{space 3}log likelihood = {res:-3888.6179}  
Iteration 4:{space 3}log likelihood = {res:-3888.6178}  
{res}
{txt}Tobit regression{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}   Uncensored    {col 67}= {res}       428
{txt}Limits: lower = {res}0{txt}{col 49}   Left-censored {col 67}= {res}       325
{txt}        upper = {res}+inf{txt}{col 49}   Right-censored{col 67}= {res}         0

{txt}{col 49}LR chi2({res}16{txt}){col 67}= {res}    132.55
{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000
{txt}Log likelihood = {res}-3888.6178{txt}{col 49}Pseudo R2{col 67}= {res}    0.0168

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}       hours{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-22.73916{col 26}{space 2}  5.02971{col 37}{space 1}   -4.52{col 46}{space 3}0.000{col 54}{space 4}-32.61342{col 67}{space 3}-12.86489
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-979.9982{col 26}{space 2}  126.779{col 37}{space 1}   -7.73{col 46}{space 3}0.000{col 54}{space 4}-1228.889{col 67}{space 3}-731.1073
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-147.4885{col 26}{space 2} 45.51545{col 37}{space 1}   -3.24{col 46}{space 3}0.001{col 54}{space 4}-236.8439{col 67}{space 3}-58.13313
{txt}{space 9}age {c |}{col 14}{res}{space 2} 650.9169{col 26}{space 2} 772.1748{col 37}{space 1}    0.84{col 46}{space 3}0.400{col 54}{space 4}-865.0075{col 67}{space 3} 2166.841
{txt}{space 8}educ {c |}{col 14}{res}{space 2}-881.6666{col 26}{space 2} 1917.465{col 37}{space 1}   -0.46{col 46}{space 3}0.646{col 54}{space 4}-4646.011{col 67}{space 3} 2882.678
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-16.15001{col 26}{space 2} 14.87967{col 37}{space 1}   -1.09{col 46}{space 3}0.278{col 54}{space 4}-45.36161{col 67}{space 3} 13.06159
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .1126286{col 26}{space 2} .1052142{col 37}{space 1}    1.07{col 46}{space 3}0.285{col 54}{space 4}-.0939267{col 67}{space 3} .3191839
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2} 59.21527{col 26}{space 2} 106.9089{col 37}{space 1}    0.55{col 46}{space 3}0.580{col 54}{space 4}-150.6671{col 67}{space 3} 269.0976
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2}-1.468838{col 26}{space 2} 2.403251{col 37}{space 1}   -0.61{col 46}{space 3}0.541{col 54}{space 4} -6.18687{col 67}{space 3} 3.249195
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2}   7.6055{col 26}{space 2} 43.68486{col 37}{space 1}    0.17{col 46}{space 3}0.862{col 54}{space 4}-78.15609{col 67}{space 3} 93.36709
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0265268{col 26}{space 2}  .370727{col 37}{space 1}   -0.07{col 46}{space 3}0.943{col 54}{space 4}-.7543336{col 67}{space 3}   .70128
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2}-.0261481{col 26}{space 2} .8689377{col 37}{space 1}   -0.03{col 46}{space 3}0.976{col 54}{space 4}-1.732036{col 67}{space 3}  1.67974
{txt}{space 8}unem {c |}{col 14}{res}{space 2}-23.34517{col 26}{space 2} 16.64972{col 37}{space 1}   -1.40{col 46}{space 3}0.161{col 54}{space 4}-56.03171{col 67}{space 3} 9.341371
{txt}{space 8}city {c |}{col 14}{res}{space 2} 51.64075{col 26}{space 2} 111.0829{col 37}{space 1}    0.46{col 46}{space 3}0.642{col 54}{space 4}-166.4358{col 67}{space 3} 269.7173
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} 8.397813{col 26}{space 2} 18.93002{col 37}{space 1}    0.44{col 46}{space 3}0.657{col 54}{space 4}-28.76538{col 67}{space 3}   45.561
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-17.30997{col 26}{space 2} 18.01221{col 37}{space 1}   -0.96{col 46}{space 3}0.337{col 54}{space 4}-52.67132{col 67}{space 3} 18.05138
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-4185.303{col 26}{space 2} 15920.82{col 37}{space 1}   -0.26{col 46}{space 3}0.793{col 54}{space 4}-35440.86{col 67}{space 3} 27070.25
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 1}var(e.hours){c |}{col 14}{res}{space 2}  1564526{col 26}{space 2} 117405.9{col 54}{space 4}  1350211{col 67}{space 3}  1812860
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. 
. *--------
. *   E   *
. *--------
. program drop _all
{txt}
{com}. capture program drop myheckman
{txt}
{com}. 
. program myheckman
{txt}  1{com}.         version 14
{txt}  2{com}.         args lnf theta1 theta2 lnsigma atanhp
{txt}  3{com}.         tempvar sigma
{txt}  4{com}.         tempvar rho
{txt}  5{com}.         gen double `sigma' = exp(`lnsigma')
{txt}  6{com}.         gen double `rho'= tanh(`atanhp')
{txt}  7{com}.         qui replace `lnf' = ln(normalden($ML_y1, `theta1',`sigma')) + ln(normal((`theta2'+ (`rho'/`sigma')*($ML_y1 -`theta1'))/sqrt(1-`rho'^2))) if $ML_y2==1
{txt}  8{com}.         qui replace `lnf' = ln(1-normal(`theta2')) if $ML_y2==0
{txt}  9{com}. end
{txt}
{com}. 
. 
. *g s=(lwage>0)
. replace lwage = 999 if lwage == .
{txt}(325 real changes made)

{com}. ml model lf myheckman (beta: lwage = $horder) (s: w = $back $horder) (lnsigma:) (atanhp:)
{res}{txt}
{com}. ml search
{res}{txt}initial:{col 16}log likelihood = {res:-1330.0429}
alternative:{col 16}log likelihood = {res:-1177.8198}
rescale:{col 16}log likelihood = {res:-1152.5633}
rescale eq:{col 16}log likelihood = {res:-985.99204}

{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-985.99204}
rescale:{col 16}log likelihood = {res:-985.99204}
rescale eq:{col 16}log likelihood = {res:-985.99204}
{res}{txt}Iteration 0:{space 3}log likelihood = {res:-985.99204}  (not concave)
Iteration 1:{space 3}log likelihood = {res:-931.27547}  (not concave)
Iteration 2:{space 3}log likelihood = {res:-907.57749}  (not concave)
Iteration 3:{space 3}log likelihood = {res:-897.99386}  
Iteration 4:{space 3}log likelihood = {res:-892.50443}  
Iteration 5:{space 3}log likelihood = {res:-878.19682}  
Iteration 6:{space 3}log likelihood = {res:-877.80151}  
Iteration 7:{space 3}log likelihood = {res:-877.79688}  
Iteration 8:{space 3}log likelihood = {res:-877.79688}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}       753
{txt}{col 49}Wald chi2({res}11{txt}){col 67}= {res}     52.48
{txt}Log likelihood = {res}-877.79688{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}beta         {txt}{c |}
{space 8}age2 {c |}{col 14}{res}{space 2}-.0013041{col 26}{space 2} .0023447{col 37}{space 1}   -0.56{col 46}{space 3}0.578{col 54}{space 4}-.0058997{col 67}{space 3} .0032914
{txt}{space 8}age3 {c |}{col 14}{res}{space 2}-4.71e-06{col 26}{space 2} .0000352{col 37}{space 1}   -0.13{col 46}{space 3}0.893{col 54}{space 4}-.0000736{col 67}{space 3} .0000642
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2}-.0313712{col 26}{space 2}  .029264{col 37}{space 1}   -1.07{col 46}{space 3}0.284{col 54}{space 4}-.0887276{col 67}{space 3} .0259851
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2} .0026168{col 26}{space 2} .0010647{col 37}{space 1}    2.46{col 46}{space 3}0.014{col 54}{space 4} .0005299{col 67}{space 3} .0047036
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} .0159046{col 26}{space 2} .0156207{col 37}{space 1}    1.02{col 46}{space 3}0.309{col 54}{space 4}-.0147115{col 67}{space 3} .0465207
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2} .0001462{col 26}{space 2} .0001937{col 37}{space 1}    0.75{col 46}{space 3}0.450{col 54}{space 4}-.0002334{col 67}{space 3} .0005258
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2}-.0012845{col 26}{space 2} .0003784{col 37}{space 1}   -3.39{col 46}{space 3}0.001{col 54}{space 4}-.0020263{col 67}{space 3}-.0005428
{txt}{space 8}unem {c |}{col 14}{res}{space 2} .0030281{col 26}{space 2} .0115846{col 37}{space 1}    0.26{col 46}{space 3}0.794{col 54}{space 4}-.0196773{col 67}{space 3} .0257335
{txt}{space 8}city {c |}{col 14}{res}{space 2} .1106182{col 26}{space 2} .0749757{col 37}{space 1}    1.48{col 46}{space 3}0.140{col 54}{space 4}-.0363314{col 67}{space 3} .2575678
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2}-.0110017{col 26}{space 2} .0130109{col 37}{space 1}   -0.85{col 46}{space 3}0.398{col 54}{space 4}-.0365025{col 67}{space 3} .0144991
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-.0136238{col 26}{space 2} .0124199{col 37}{space 1}   -1.10{col 46}{space 3}0.273{col 54}{space 4}-.0379664{col 67}{space 3} .0107189
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} .8436898{col 26}{space 2} .6998049{col 37}{space 1}    1.21{col 46}{space 3}0.228{col 54}{space 4}-.5279026{col 67}{space 3} 2.215282
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}s            {txt}{c |}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-.0173274{col 26}{space 2} .0045883{col 37}{space 1}   -3.78{col 46}{space 3}0.000{col 54}{space 4}-.0263202{col 67}{space 3}-.0083346
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-.7494804{col 26}{space 2} .1257255{col 37}{space 1}   -5.96{col 46}{space 3}0.000{col 54}{space 4}-.9958978{col 67}{space 3}-.5030629
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-.0598926{col 26}{space 2} .0400635{col 37}{space 1}   -1.49{col 46}{space 3}0.135{col 54}{space 4}-.1384156{col 67}{space 3} .0186305
{txt}{space 9}age {c |}{col 14}{res}{space 2} .6492303{col 26}{space 2} .6990086{col 37}{space 1}    0.93{col 46}{space 3}0.353{col 54}{space 4}-.7208015{col 67}{space 3} 2.019262
{txt}{space 8}educ {c |}{col 14}{res}{space 2} .2182786{col 26}{space 2} 1.704854{col 37}{space 1}    0.13{col 46}{space 3}0.898{col 54}{space 4}-3.123173{col 67}{space 3} 3.559731
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-.0151905{col 26}{space 2} .0133599{col 37}{space 1}   -1.14{col 46}{space 3}0.256{col 54}{space 4}-.0413754{col 67}{space 3} .0109944
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .0001193{col 26}{space 2} .0000942{col 37}{space 1}    1.27{col 46}{space 3}0.205{col 54}{space 4}-.0000653{col 67}{space 3} .0003038
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2}-.0179301{col 26}{space 2} .0950241{col 37}{space 1}   -0.19{col 46}{space 3}0.850{col 54}{space 4}-.2041739{col 67}{space 3} .1683136
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2} .0001218{col 26}{space 2} .0021778{col 37}{space 1}    0.06{col 46}{space 3}0.955{col 54}{space 4}-.0041466{col 67}{space 3} .0043902
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2}  .000548{col 26}{space 2} .0410868{col 37}{space 1}    0.01{col 46}{space 3}0.989{col 54}{space 4}-.0799807{col 67}{space 3} .0810767
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0001331{col 26}{space 2} .0003576{col 37}{space 1}   -0.37{col 46}{space 3}0.710{col 54}{space 4}-.0008341{col 67}{space 3} .0005678
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} .0005223{col 26}{space 2} .0007904{col 37}{space 1}    0.66{col 46}{space 3}0.509{col 54}{space 4}-.0010269{col 67}{space 3} .0020715
{txt}{space 8}unem {c |}{col 14}{res}{space 2}  -.00957{col 26}{space 2} .0158171{col 37}{space 1}   -0.61{col 46}{space 3}0.545{col 54}{space 4}-.0405709{col 67}{space 3} .0214309
{txt}{space 8}city {c |}{col 14}{res}{space 2} .0411958{col 26}{space 2} .1066942{col 37}{space 1}    0.39{col 46}{space 3}0.699{col 54}{space 4} -.167921{col 67}{space 3} .2503125
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} .0042797{col 26}{space 2} .0182445{col 37}{space 1}    0.23{col 46}{space 3}0.815{col 54}{space 4}-.0314788{col 67}{space 3} .0400382
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-.0150309{col 26}{space 2} .0172747{col 37}{space 1}   -0.87{col 46}{space 3}0.384{col 54}{space 4}-.0488887{col 67}{space 3} .0188269
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-9.190785{col 26}{space 2} 14.27711{col 37}{space 1}   -0.64{col 46}{space 3}0.520{col 54}{space 4}-37.17341{col 67}{space 3} 18.79184
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2}-.2949261{col 26}{space 2} .0642094{col 37}{space 1}   -4.59{col 46}{space 3}0.000{col 54}{space 4}-.4207742{col 67}{space 3} -.169078
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}atanhp       {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2}-.8111952{col 26}{space 2} .2187657{col 37}{space 1}   -3.71{col 46}{space 3}0.000{col 54}{space 4}-1.239968{col 67}{space 3}-.3824224
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. *See if it coincides:
. heckman lwage $horder, select(w = $back $horder)
{res}
{txt}Iteration 0:{space 3}log likelihood = {res:-878.81877}  
Iteration 1:{space 3}log likelihood = {res:-878.47351}  
Iteration 2:{space 3}log likelihood = {res:-877.91766}  
Iteration 3:{space 3}log likelihood = {res: -877.7977}  
Iteration 4:{space 3}log likelihood = {res:-877.79688}  
Iteration 5:{space 3}log likelihood = {res:-877.79688}  
{res}
{txt}Heckman selection model                         Number of obs     = {res}       753
{txt}(regression model with sample selection)              Selected    = {res}       428
                                                {txt}      Nonselected = {res}       325

                                                {txt}Wald chi2({res}11{txt})     =  {res}    52.48
{txt}Log likelihood = {res}-877.7969                      {txt}Prob > chi2       =     {res}0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lwage        {txt}{c |}
{space 8}age2 {c |}{col 14}{res}{space 2}-.0013041{col 26}{space 2} .0023447{col 37}{space 1}   -0.56{col 46}{space 3}0.578{col 54}{space 4}-.0058997{col 67}{space 3} .0032914
{txt}{space 8}age3 {c |}{col 14}{res}{space 2}-4.71e-06{col 26}{space 2} .0000352{col 37}{space 1}   -0.13{col 46}{space 3}0.893{col 54}{space 4}-.0000736{col 67}{space 3} .0000642
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2}-.0313712{col 26}{space 2}  .029264{col 37}{space 1}   -1.07{col 46}{space 3}0.284{col 54}{space 4}-.0887276{col 67}{space 3} .0259851
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2} .0026168{col 26}{space 2} .0010647{col 37}{space 1}    2.46{col 46}{space 3}0.014{col 54}{space 4} .0005299{col 67}{space 3} .0047036
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2} .0159046{col 26}{space 2} .0156207{col 37}{space 1}    1.02{col 46}{space 3}0.309{col 54}{space 4}-.0147115{col 67}{space 3} .0465207
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2} .0001462{col 26}{space 2} .0001937{col 37}{space 1}    0.75{col 46}{space 3}0.450{col 54}{space 4}-.0002334{col 67}{space 3} .0005258
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2}-.0012845{col 26}{space 2} .0003784{col 37}{space 1}   -3.39{col 46}{space 3}0.001{col 54}{space 4}-.0020263{col 67}{space 3}-.0005428
{txt}{space 8}unem {c |}{col 14}{res}{space 2} .0030281{col 26}{space 2} .0115846{col 37}{space 1}    0.26{col 46}{space 3}0.794{col 54}{space 4}-.0196773{col 67}{space 3} .0257335
{txt}{space 8}city {c |}{col 14}{res}{space 2} .1106182{col 26}{space 2} .0749757{col 37}{space 1}    1.48{col 46}{space 3}0.140{col 54}{space 4}-.0363314{col 67}{space 3} .2575678
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2}-.0110017{col 26}{space 2} .0130109{col 37}{space 1}   -0.85{col 46}{space 3}0.398{col 54}{space 4}-.0365025{col 67}{space 3} .0144991
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-.0136238{col 26}{space 2} .0124199{col 37}{space 1}   -1.10{col 46}{space 3}0.273{col 54}{space 4}-.0379664{col 67}{space 3} .0107189
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} .8436894{col 26}{space 2} .6998048{col 37}{space 1}    1.21{col 46}{space 3}0.228{col 54}{space 4}-.5279028{col 67}{space 3} 2.215282
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}w            {txt}{c |}
{space 4}nwifeinc {c |}{col 14}{res}{space 2}-.0173274{col 26}{space 2} .0045883{col 37}{space 1}   -3.78{col 46}{space 3}0.000{col 54}{space 4}-.0263202{col 67}{space 3}-.0083346
{txt}{space 5}kidslt6 {c |}{col 14}{res}{space 2}-.7494805{col 26}{space 2} .1257255{col 37}{space 1}   -5.96{col 46}{space 3}0.000{col 54}{space 4} -.995898{col 67}{space 3}-.5030631
{txt}{space 5}kidsge6 {c |}{col 14}{res}{space 2}-.0598926{col 26}{space 2} .0400635{col 37}{space 1}   -1.49{col 46}{space 3}0.135{col 54}{space 4}-.1384157{col 67}{space 3} .0186305
{txt}{space 9}age {c |}{col 14}{res}{space 2} .6492305{col 26}{space 2} .6990087{col 37}{space 1}    0.93{col 46}{space 3}0.353{col 54}{space 4}-.7208014{col 67}{space 3} 2.019262
{txt}{space 8}educ {c |}{col 14}{res}{space 2} .2182795{col 26}{space 2} 1.704854{col 37}{space 1}    0.13{col 46}{space 3}0.898{col 54}{space 4}-3.123173{col 67}{space 3} 3.559732
{txt}{space 8}age2 {c |}{col 14}{res}{space 2}-.0151905{col 26}{space 2} .0133599{col 37}{space 1}   -1.14{col 46}{space 3}0.256{col 54}{space 4}-.0413754{col 67}{space 3} .0109944
{txt}{space 8}age3 {c |}{col 14}{res}{space 2} .0001193{col 26}{space 2} .0000942{col 37}{space 1}    1.27{col 46}{space 3}0.205{col 54}{space 4}-.0000653{col 67}{space 3} .0003038
{txt}{space 9}ed2 {c |}{col 14}{res}{space 2}-.0179302{col 26}{space 2} .0950241{col 37}{space 1}   -0.19{col 46}{space 3}0.850{col 54}{space 4} -.204174{col 67}{space 3} .1683136
{txt}{space 9}ed3 {c |}{col 14}{res}{space 2} .0001218{col 26}{space 2} .0021778{col 37}{space 1}    0.06{col 46}{space 3}0.955{col 54}{space 4}-.0041466{col 67}{space 3} .0043902
{txt}{space 6}inter1 {c |}{col 14}{res}{space 2}  .000548{col 26}{space 2} .0410868{col 37}{space 1}    0.01{col 46}{space 3}0.989{col 54}{space 4}-.0799807{col 67}{space 3} .0810767
{txt}{space 6}inter2 {c |}{col 14}{res}{space 2}-.0001331{col 26}{space 2} .0003576{col 37}{space 1}   -0.37{col 46}{space 3}0.710{col 54}{space 4}-.0008341{col 67}{space 3} .0005678
{txt}{space 6}inter3 {c |}{col 14}{res}{space 2} .0005223{col 26}{space 2} .0007904{col 37}{space 1}    0.66{col 46}{space 3}0.509{col 54}{space 4}-.0010269{col 67}{space 3} .0020715
{txt}{space 8}unem {c |}{col 14}{res}{space 2}  -.00957{col 26}{space 2} .0158171{col 37}{space 1}   -0.61{col 46}{space 3}0.545{col 54}{space 4}-.0405709{col 67}{space 3} .0214309
{txt}{space 8}city {c |}{col 14}{res}{space 2} .0411958{col 26}{space 2} .1066942{col 37}{space 1}    0.39{col 46}{space 3}0.699{col 54}{space 4} -.167921{col 67}{space 3} .2503125
{txt}{space 4}motheduc {c |}{col 14}{res}{space 2} .0042797{col 26}{space 2} .0182445{col 37}{space 1}    0.23{col 46}{space 3}0.815{col 54}{space 4}-.0314788{col 67}{space 3} .0400382
{txt}{space 4}fatheduc {c |}{col 14}{res}{space 2}-.0150309{col 26}{space 2} .0172747{col 37}{space 1}   -0.87{col 46}{space 3}0.384{col 54}{space 4}-.0488887{col 67}{space 3} .0188269
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}-9.190792{col 26}{space 2} 14.27711{col 37}{space 1}   -0.64{col 46}{space 3}0.520{col 54}{space 4}-37.17342{col 67}{space 3} 18.79183
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 5}/athrho {c |}{col 14}{res}{space 2}-.8111945{col 26}{space 2} .2187658{col 37}{space 1}   -3.71{col 46}{space 3}0.000{col 54}{space 4}-1.239968{col 67}{space 3}-.3824214
{txt}{space 4}/lnsigma {c |}{col 14}{res}{space 2}-.2949262{col 26}{space 2} .0642094{col 37}{space 1}   -4.59{col 46}{space 3}0.000{col 54}{space 4}-.4207743{col 67}{space 3}-.1690782
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
         rho {c |}{col 14}{res}{space 2}-.6702487{col 26}{space 2} .1204889{col 54}{space 4}-.8454464{col 67}{space 3}-.3648085
{txt}       sigma {c |}{col 14}{res}{space 2} .7445865{col 26}{space 2} .0478094{col 54}{space 4} .6565382{col 67}{space 3} .8444429
{txt}      lambda {c |}{col 14}{res}{space 2}-.4990581{col 26}{space 2} .1179995{col 54}{space 4}-.7303329{col 67}{space 3}-.2677834
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
LR test of indep. eqns. (rho = 0):   chi2({res}1{txt}) = {res}    3.16   {txt}Prob > chi2 = {res}0.0753
{txt}
{com}. 
. 
. ****************
. *   Question 2 *
. ****************
. ****** 2.b
. clear all
{res}{txt}
{com}. use friedberg_cps.dta
{txt}
{com}. 
. gen agemin65=age-65
{txt}
{com}. gen budget_segment=0
{txt}
{com}. replace budget_segment = 1 if belowkink==1
{txt}(1,911 real changes made)

{com}. replace budget_segment = 2 if middlesegment==1
{txt}(789 real changes made)

{com}. replace budget_segment = 3 if uppersegment==1
{txt}(4,086 real changes made)

{com}. 
. gen threshold_hours=threshold/hrlywage
{txt}
{com}. 
. * Get Tau
. gen     etau = 0.5 if inrange(age, 62, 64)
{txt}(4,428 missing values generated)

{com}. replace etau = 0.33 if inrange(age, 65, 69)
{txt}(3,102 real changes made)

{com}. replace etau = 0 if age>69
{txt}(1,326 real changes made)

{com}. 
. 
. *Get net wage and virtual wage
. foreach x of numlist 1/3 {c -(}
{txt}  2{com}.         gen netwage`x'=hrlywage
{txt}  3{com}.         gen virtual_inc`x'=non_labor_inc 
{txt}  4{com}. {c )-}
{txt}
{com}. 
. replace netwage2=etau*netwage2 
{txt}(7,842 real changes made)

{com}. 
. replace virtual_inc2=non_labor_inc+etau*threshold
{txt}(6,516 real changes made)

{com}. replace virtual_inc3=non_labor_inc-incss
{txt}(4,313 real changes made)

{com}. 
. 
. *Program for kinked1
. 
. program nonlinbudget
{txt}  1{com}.         version 14
{txt}  2{com}.         args lnf thetax thetaw thetay lnsigma
{txt}  3{com}.         tempvar theta1 theta2 theta3 sigma
{txt}  4{com}.         quietly gen double `sigma' = exp(`lnsigma')
{txt}  5{com}.         quietly gen double `theta1' = `thetax' + `thetaw'*$ML_y2 + `thetay'*$ML_y5 
{txt}  6{com}.         quietly gen double `theta2' = `thetax' + `thetaw'*$ML_y3 + `thetay'*$ML_y6 
{txt}  7{com}.         quietly gen double `theta3' = `thetax' + `thetaw'*$ML_y4 + `thetay'*$ML_y7
{txt}  8{com}. 
.         quietly replace `lnf'= log((1/`sigma')* ///
>                         normalden(($ML_y1-`theta1')/`sigma')) if $ML_y9==1 //bottom
{txt}  9{com}.                         
.         quietly replace `lnf'= log((1/`sigma')* ///
>                         normalden(($ML_y1-`theta2')/`sigma')) if $ML_y9==2 // mid
{txt} 10{com}.                         
.         quietly replace `lnf'= log((1/`sigma')* ///
>                         normalden(($ML_y1-`theta3')/`sigma')) if $ML_y9==3 // top
{txt} 11{com}.                         
.         quietly replace `lnf'= ///
>          log(normal(($ML_y8-`theta2')/`sigma')-normal(($ML_y8-`theta1')/`sigma')) ///
>          if (normal(($ML_y8-`theta2')/`sigma')-normal(($ML_y8-`theta1')/`sigma'))>0 ///
>          & $ML_y9==0 // kink, non negative value
{txt} 12{com}.          
.         // How is this making MLE avoid this? OHHHHHH are you saying if you make this term be negative it is v bad?
.          quietly replace `lnf'= -99999 ///
>          if normal(($ML_y8-`theta2')/`sigma')-normal(($ML_y8-`theta1')/`sigma')<=0 ///
>          & $ML_y9==0 // kink negative value, make ml avoid this case
{txt} 13{com}. 
.         // why do we need this?
.         quietly replace `lnf' = `lnf' - log(normal(`theta1'/`sigma')) //truncation 
{txt} 14{com}. end
{txt}
{com}. 
. 
. *Just created some initial values
. 
. mat all= [321.3,59.3,263.62,-131.96,937.33,38.8,-.03814,7.099]
{txt}
{com}. 
. ml model lf nonlinbudget (betax: annhours netwage1 netwage2 netwage3 ///
>                 virtual_inc1 virtual_inc2 virtual_inc3 threshold_hours budget_segment = ///
>                 hsgrad nonwhite married agemin65) (betaw:) (betay:) (lnsigma:)
{res}{txt}
{com}. ml init all, copy
{res}{txt}
{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-57846.504}
rescale:{col 16}log likelihood = {res:-57846.504}
rescale eq:{col 16}log likelihood = {res:-57846.504}
{res}{txt}Iteration 0:{space 3}log likelihood = {res:-57846.504}  
Iteration 1:{space 3}log likelihood = {res:-57822.061}  
Iteration 2:{space 3}log likelihood = {res:-57802.837}  
Iteration 3:{space 3}log likelihood = {res:-57802.713}  
Iteration 4:{space 3}log likelihood = {res:-57802.713}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}     7,842
{txt}{col 49}Wald chi2({res}4{txt}){col 67}= {res}    435.45
{txt}Log likelihood = {res}-57802.713{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betax        {txt}{c |}
{space 6}hsgrad {c |}{col 14}{res}{space 2} 251.5249{col 26}{space 2} 35.44017{col 37}{space 1}    7.10{col 46}{space 3}0.000{col 54}{space 4} 182.0634{col 67}{space 3} 320.9864
{txt}{space 4}nonwhite {c |}{col 14}{res}{space 2} 88.12086{col 26}{space 2} 58.58043{col 37}{space 1}    1.50{col 46}{space 3}0.133{col 54}{space 4}-26.69468{col 67}{space 3} 202.9364
{txt}{space 5}married {c |}{col 14}{res}{space 2} 196.5525{col 26}{space 2} 53.92128{col 37}{space 1}    3.65{col 46}{space 3}0.000{col 54}{space 4}  90.8687{col 67}{space 3} 302.2362
{txt}{space 4}agemin65 {c |}{col 14}{res}{space 2} -124.642{col 26}{space 2} 6.553184{col 37}{space 1}  -19.02{col 46}{space 3}0.000{col 54}{space 4} -137.486{col 67}{space 3} -111.798
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 857.3602{col 26}{space 2} 61.81666{col 37}{space 1}   13.87{col 46}{space 3}0.000{col 54}{space 4} 736.2018{col 67}{space 3} 978.5186
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betaw        {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 45.29674{col 26}{space 2}  1.46846{col 37}{space 1}   30.85{col 46}{space 3}0.000{col 54}{space 4} 42.41861{col 67}{space 3} 48.17487
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betay        {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} -.027275{col 26}{space 2} .0013459{col 37}{space 1}  -20.27{col 46}{space 3}0.000{col 54}{space 4}-.0299129{col 67}{space 3}-.0246371
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 7.063945{col 26}{space 2} .0175534{col 37}{space 1}  402.43{col 46}{space 3}0.000{col 54}{space 4} 7.029541{col 67}{space 3} 7.098349
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. 
. 
. mat b =e(b)
{txt}
{com}. scalar wagecoef= b[1,6]
{txt}
{com}. gen wage=hrlywage
{txt}
{com}. replace wage=hrlywage*.5 if budget_segment==2 |budget_segment==0
{txt}(1,845 real changes made)

{com}. sum wage

{txt}    Variable {c |}        Obs        Mean    Std. Dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 8}wage {c |}{res}      7,842    10.52819    9.429978   .5173349   98.24865
{txt}
{com}. scalar wagemean = r(mean)
{txt}
{com}. sum annhours

{txt}    Variable {c |}        Obs        Mean    Std. Dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 4}annhours {c |}{res}      7,842    1458.318    879.8882          4       5148
{txt}
{com}. scalar hoursmean = r(mean)
{txt}
{com}. 
. /*
> Uncompensated wage elasticity is the derivative of hours w.r.t. to net wage
> times the average net wage over the average hours
> */
. di "Uncompensated wage elasticity:" wagecoef*wagemean/hoursmean
{res}Uncompensated wage elasticity:.3270158
{txt}
{com}. 
. ****** 2.c 
. foreach x of numlist 1/3 {c -(}
{txt}  2{com}.         gen lnetwage`x'=log(netwage`x') 
{txt}  3{com}. {c )-}
{txt}(1,326 missing values generated)

{com}. mat all= [321.3,59.3,263.62,-131.96,937.33,log(38.8),-.03814,7.099]
{txt}
{com}. 
. ml model lf nonlinbudget (betax: annhours lnetwage1 lnetwage2 lnetwage3 ///
>                 virtual_inc1 virtual_inc2 virtual_inc3 threshold_hours budget_segment = ///
>                 hsgrad nonwhite married agemin65) (betaw:) (betay:) (lnsigma:)
{res}{txt}
{com}. ml init all, copy
{res}{txt}
{com}. ml maximize
{res}
{txt}initial:{col 16}log likelihood = {res:-49510.862}
rescale:{col 16}log likelihood = {res:-49510.862}
rescale eq:{col 16}log likelihood = {res:-48382.256}
{res}{txt}Iteration 0:{space 3}log likelihood = {res:-48382.256}  
Iteration 1:{space 3}log likelihood = {res:-48112.157}  
Iteration 2:{space 3}log likelihood = {res: -47989.86}  
Iteration 3:{space 3}log likelihood = {res:-47982.788}  
Iteration 4:{space 3}log likelihood = {res:-47982.771}  
Iteration 5:{space 3}log likelihood = {res:-47982.771}  
{res}
{txt}{col 49}Number of obs{col 67}= {res}     6,516
{txt}{col 49}Wald chi2({res}4{txt}){col 67}= {res}    250.41
{txt}Log likelihood = {res}-47982.771{txt}{col 49}Prob > chi2{col 67}= {res}    0.0000

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betax        {txt}{c |}
{space 6}hsgrad {c |}{col 14}{res}{space 2} 151.4503{col 26}{space 2} 30.95689{col 37}{space 1}    4.89{col 46}{space 3}0.000{col 54}{space 4}  90.7759{col 67}{space 3} 212.1247
{txt}{space 4}nonwhite {c |}{col 14}{res}{space 2} 85.25673{col 26}{space 2} 51.63648{col 37}{space 1}    1.65{col 46}{space 3}0.099{col 54}{space 4}-15.94892{col 67}{space 3} 186.4624
{txt}{space 5}married {c |}{col 14}{res}{space 2}   151.52{col 26}{space 2} 47.56154{col 37}{space 1}    3.19{col 46}{space 3}0.001{col 54}{space 4} 58.30108{col 67}{space 3} 244.7389
{txt}{space 4}agemin65 {c |}{col 14}{res}{space 2} -108.637{col 26}{space 2} 7.499426{col 37}{space 1}  -14.49{col 46}{space 3}0.000{col 54}{space 4}-123.3356{col 67}{space 3}-93.93841
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 352.4167{col 26}{space 2} 60.02409{col 37}{space 1}    5.87{col 46}{space 3}0.000{col 54}{space 4} 234.7717{col 67}{space 3} 470.0618
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betaw        {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 502.3928{col 26}{space 2} 15.48123{col 37}{space 1}   32.45{col 46}{space 3}0.000{col 54}{space 4} 472.0501{col 67}{space 3} 532.7354
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}betay        {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2}-.0154986{col 26}{space 2} .0010565{col 37}{space 1}  -14.67{col 46}{space 3}0.000{col 54}{space 4}-.0175694{col 67}{space 3}-.0134279
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}lnsigma      {txt}{c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 6.925517{col 26}{space 2} .0142765{col 37}{space 1}  485.10{col 46}{space 3}0.000{col 54}{space 4} 6.897535{col 67}{space 3} 6.953498
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}

{com}. mat b =e(b)
{txt}
{com}. scalar lwagecoef= b[1,6]
{txt}
{com}. 
. 
. /*
> ************Trying to figure out which is which - HERE THERE IS A PROBLEM ---> THINGS SHOULD COINCIDE
> g probar = belowkink + middlesegment + uppersegment + atkink
> tab probar,m
> 
> g MS=(threshold<earnings<threshold+incss/tau)
> g BK=(earnings<threshold)
> g atBK=belowkink+ atkink
> tab BK belowkink 
> tab BK atBK
> tab MS middlesegment
> 
> */
. *****************
. * Question 3
. *****************
. *The dofile contains the solution for both cases delta=1000 and delta=1500
. 
. clear all
{res}{txt}
{com}. use cps_ssa_1978.dta
{txt}(1978 CPS SSA Exact Match File)

{com}. g earn_minus_threshold=earn-threshold
{txt}
{com}. 
. *Histogram
. histogram earn_minus_threshold if inrange(earn_minus_threshold, -2000, 2000), width(50) xline(0)
{txt}(bin={res}80{txt}, start={res}-1994.5613{txt}, width={res}50{txt})
{res}{txt}
{com}. 
. 
. *Create Groups
. *H*
. local delta = 1500
{txt}
{com}. *local delta= 1000
. g Hstar= (earn_minus_threshold-`delta'<earn<=earn_minus_threshold+`delta')
{txt}
{com}. 
. *Hstarminus
. g Hstarminus=(earn_minus_threshold -2*`delta'<earn<earn_minus_threshold -`delta')
{txt}
{com}. 
. *Hstarplus
. g Hstarplus=(earn_minus_threshold +`delta'<earn<earn_minus_threshold +2*`delta')
{txt}
{com}. 
. *Create means
. foreach var of varlist Hstar Hstarminus Hstarplus{c -(}
{txt}  2{com}.         qui sum `var'
{txt}  3{com}.         local `var'=r(mean)*100         
{txt}  4{com}. {c )-}
{txt}
{com}. 
. local B = Hstar-(Hstarminus+Hstarplus)
{txt}
{com}. di `B'
{res}-1
{txt}
{com}. 
. local Hstarminus = Hstarminus/`delta'
{txt}
{com}. local Hstarplus=Hstarplus/`delta'
{txt}
{com}. 
. di `Hstarminus'
{res}.00066667
{txt}
{com}. di `Hstarplus'
{res}.00066667
{txt}
{com}. 
. *Calculate e
. *Create H 
. local ache=(Hstarminus + Hstarplus)/2
{txt}
{com}. local e=((`B'/`ache')/(earn_minus_threshold)*(ln((1-0)/(1-0.5))))
{txt}
{com}. di `e'
{res}-.00002739
{txt}
{com}. 
. log close
      {txt}name:  {res}<unnamed>
       {txt}log:  {res}/Users/leticiajuarez/Desktop/621 - Field Class Labor/Homeworks/HW3/HW3.smcl
  {txt}log type:  {res}smcl
 {txt}closed on:  {res} 2 Oct 2018, 19:09:20
{txt}{.-}
{smcl}
{txt}{sf}{ul off}